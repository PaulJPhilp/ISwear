---
import Layout from '~/layouts/PageLayout.astro';
import Subway from '~/components/subway/Subway.astro';
import BlogLatestPosts from '~/components/widgets/BlogLatestPosts.astro';
import type { RoundelProps } from '~/components/widgets/Roundel.astro';
import type { StationProps } from '~/types/station';
import { TflColors } from '~/tflColors';
import { generateRoundel, registerRoundel } from '~/utils/generateRoundel';

const metadata = {
  title: 'I Swear It Happened Like This',
  ignoreTitleTemplate: true,
};

// Define the base roundel first
const subwayRoundel: RoundelProps = {
  size: 156.25,
  position: { x: 156.25, y: 156.25 },
  height: 156.25,
  width: 156.25,
  margin: 25,
  innerCircle: {
    radius: 78.125,
    color: TflColors.tflWhite,
    center: { x: 78.125, y: 78.125 },
  },
  outerCircle: {
    radius: 78.125,
    color: TflColors.tflWhite,
    center: { x: 78.125, y: 78.125 },
  },
  rect: {
    width: 156.25,
    height: 156.25,
    top: 0,
    left: 0,
    color: TflColors.tflBlue,
    border: {
      strokeWidth: 2.5,
      stroke: TflColors.tflBlue,
    },
  },
  label: { text: 'Subway', fontSize: '18.75px', fontWeight: 'bold', color: TflColors.tflWhite },
};

// Register the foundation roundel
registerRoundel('Foundation', subwayRoundel);

// Define the buildRoundel function after subwayRoundel is defined
function buildRoundel(topic: string): RoundelProps {
  const roundel = structuredClone(subwayRoundel);
  roundel.label.text = topic;
  roundel.label.fontSize = '15px';
  roundel.label.fontWeight = 'normal';
  roundel.innerCircle.color = TflColors.tflWhite;
  roundel.outerCircle.color = TflColors.tflBlue;
  registerRoundel(topic, roundel);
  return generateRoundel(topic);
}

const AllStations: { title: string; stations: StationProps[] } = {
  title: 'Foundation',
  stations: [
    {
      topic: 'Moore',
      title: "Moore's Law",
      description:
        'Computing power doubles every two years, while costs halve - the relentless force driving the software economy.',
      stations: [
        {
          topic: "Shannon's Law",
          title: "Shannon's Law",
          description: 'The mathematical limits of information transmission.',
          stations: [],
          roundel: buildRoundel("Shannon's Law"),
        },
      ],
      roundel: buildRoundel('Moore'),
    },
    {
      topic: 'Latency',
      title: 'Latency Is Destiny',
      description: 'The speed of light sets the ultimate limits - in a digital world, distance still shapes destiny.',
      stations: [
        {
          topic: "Amdahl's Law",
          title: "Amdahl's Law",
          description: 'The limits of parallel processing.',
          stations: [],
          roundel: buildRoundel("Amdahl's Law"),
        },
        {
          topic: "Brooker's Law",
          title: "Brooker's Law",
          description: 'Adding more people to a late project makes it later.',
          stations: [],
          roundel: buildRoundel("Brooker's Law"),
        },
        {
          topic: "Conway's Law",
          title: "Conway's Law",
          description: 'Organizations design systems that mirror their communication structures.',
          stations: [],
          roundel: buildRoundel("Conway's Law"),
        },
      ],
      roundel: buildRoundel('Latency'),
    },
    {
      topic: 'Deming',
      title: 'The Wisdom of Deming',
      description:
        'Measure to improve, not to blame - the revolutionary insight that transformed Japanese industry and Silicon Valley culture.',
      stations: [
        {
          topic: 'Lean',
          title: 'Lean',
          description: 'Eliminate waste, optimize flow.',
          stations: [],
          roundel: buildRoundel('Lean'),
        },
        {
          topic: 'Agile',
          title: 'Agile',
          description: 'Iterate, adapt, deliver.',
          stations: [],
          roundel: buildRoundel('Agile'),
        },
      ],
      roundel: buildRoundel('Deming'),
    },
    {
      topic: 'Modularity',
      title: 'The Law of Increasing Modularity',
      description:
        'As interfaces standardize, leaders fragment - the invisible force that evolves complex technologies into modular ecosystems.',
      stations: [
        {
          topic: 'Law of Increasing Modularity',
          title: 'Law of Increasing Modularity',
          description: 'As interfaces standardize, leaders fragment.',
          stations: [],
          roundel: buildRoundel('Law of Increasing Modularity'),
        },
        {
          topic: 'Mind the Chasm',
          title: 'Mind the Chasm',
          description: 'Crossing the chasm between early adopters and the mainstream.',
          stations: [],
          roundel: buildRoundel('Mind the Chasm'),
        },
      ],
      roundel: buildRoundel('Modularity'),
    },
    {
      topic: 'Systems',
      title: "It's Systems All the Way Down",
      description: 'Everything is connected - feedback loops shapes all complex behavior.',
      stations: [
        {
          topic: 'McLuhan',
          title: 'The Medium is the Message',
          description: 'How we communicate shapes what we say - Twitter makes us brief, books make us deep, TikTok makes us visual.',
          stations: [],
          roundel: buildRoundel('McLuhan'),
        },
      ],
      roundel: buildRoundel('Systems'),
    },
  ],
};
---

<Layout metadata={metadata}>
  <Subway stations={AllStations.stations} title={AllStations.title} />
  <BlogLatestPosts title="Latest Blog Posts" count={5} />
</Layout>
